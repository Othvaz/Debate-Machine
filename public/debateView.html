<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View Stored Debates</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="flex flex-col gap-4 bg-slate-100 text-slate-800 font-sans p-4 sm:p-8">
    <div id="nav-placeholder"></div>
    <script>
    (async ()=>{
        const r = await fetch('/navbar.html');
        if (r.ok) document.getElementById('nav-placeholder').innerHTML = await r.text();
    })();
    </script>

    <main class="ml-64">
        <div id="debate" class="flex justify-center gap-4">
            <article class="border-gray-300 grid grid-cols-1 text-center border lg:w-[75%] sm:w-[90%] gap-4 p-5">
                <div class="text-center border p-2">
                    <span class="font-medium" id="debateIndexText">Debate Index No. 1</span>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div id="modelA" class="border p-2">
                        <label for="modelA" class="block text-center font-medium m-2 mt-1">Model A</label>
                        <hr>
                        <label for="modelA" id="viewModelAText" class="m-2 mt-1 text-center">
                            gpt-5-mini
                        </label>
                    </div>
                    <div id="modelB" class="border p-2">
                        <label for="modelB" class="block text-center font-medium m-2 mt-1">Model B</label>
                        <hr>
                        <label for="modelB" id="viewModelBText" class="m-2 mt-1 text-center">
                            qwen3-235b-a22b 
                        </label>
                    </div>
                </div>
                <div id="perspectives" class="border p-2">
                    <label for="perspectives" class="m-2 mt-1 font-medium block text-center">Perspectives</label>
                    <hr>
                    <label for="perspectives" id="viewPerspectiveText" class="m-2 mt-1 text-center">Morality, Ethics, Religion</label>
                </div>
                <div id="debateInput" class="border">
                    <label for="debateInput" class="block m-2 mt-1 font-medium">Debate Input</label>
                    <hr class="border">
                    <span class="block text-start m-3" id="debateInputText">Alice</span>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div id="openingFor" class="border">
                        <label for="openingFor" class="block m-2 mt-1 font-medium">Opening [For]</label>
                        <hr class="border">
                        <span id="openingForText" class="block text-start m-3">Alice</span>
                    </div>
                    <div id="openingAgainst" class="border">
                        <label for="openingAgainst" class="block m-2 mt-1 font-medium">Opening [Against]</label>
                        <hr class="border">
                        <span id="openingAgainstText" class="block text-start m-3">Alice</span>
                    </div>
                    <div id="rebuttalFor" class="border">
                        <label for="rebuttalFor" class="block m-2 mt-1 font-medium">Rebuttal [For]</label>
                        <hr class="border">
                        <span id="rebuttalForText" class="block text-start m-3">Alice</span>
                    </div>
                    <div id="rebuttalAgainst" class="border">
                        <label for="rebuttalAgainst" class="block m-2 mt-1 font-medium">Rebuttal [Against]</label>
                        <hr class="border">
                        <span id="rebuttalAgainstText" class="block text-start m-3">Alice</span>
                    </div>
                    <div id="followupFor" class="border">
                        <label for="followupFor" class="block m-2 mt-1 font-medium">Followup [For]</label>
                        <hr class="border">
                        <span id="followupForText" class="block text-start m-3">Alice</span>
                    </div>
                    <div id="followupAgainst" class="border">
                        <label for="followupAgainst" class="block m-2 mt-1 font-medium">Followup [Against]</label>
                        <hr class="border">
                        <span id="followupAgainstText" class="block text-start m-3">Alice</span>
                    </div>
                </div>
            </article>
        </div>
    </main>
    


    <script>
        (async () => {
          try {
            function setText(id, text){ const el = document.getElementById(id); if (el) el.textContent = text || ''; }
            const fmtPers = (p) => {
              if (Array.isArray(p)) return p.join(', ');
              if (typeof p === 'string'){
                try { const parsed = JSON.parse(p); if (Array.isArray(parsed)) return parsed.join(', '); } catch(e) {}
                if (p.startsWith('{') && p.endsWith('}')) return p.slice(1,-1).split(',').map(s=>s.replace(/^"|"$/g,'')).join(', ');
                return p;
              }
              return '';
            };
        
            const res = await fetch('/api/getdebates');
            if (!res.ok) throw new Error('Network response ' + res.status);
            const debates = await res.json();
            if (!Array.isArray(debates) || debates.length === 0){ alert('No debates found'); return; }
                    if (document.readyState === 'loading') {
              await new Promise(resolve => document.addEventListener('DOMContentLoaded', resolve, { once: true }));
            }
        
            let idx = 0;
            const render = () => {
              const d = debates[idx];
              setText('debateIndexText', `Debate Index No. ${d.debateinputid}`);
              setText('viewModelAText', d.modela);
              setText('viewModelBText', d.modelb);
              setText('viewPerspectiveText', fmtPers(d.perspectives));
              setText('debateInputText', d.debateinputtext);
              setText('openingForText', d.debateoutputtextopeningfor);
              setText('openingAgainstText', d.debateoutputtextopeningagainst);
              setText('rebuttalForText', d.debateoutputtextrebuttalfor);
              setText('rebuttalAgainstText', d.debateoutputtextrebuttalagainst);
              setText('followupForText', d.debateoutputtextfollowupfor);
              setText('followupAgainstText', d.debateoutputtextfollowupagainst);
            };
        
            render();
        
            document.addEventListener('keydown', (event) => {
              if (event.key === 'ArrowLeft') {
                if (idx > 0) {
                  idx = idx - 1;
                } else {
                  idx = debates.length - 1;
                }
                render();
              } else if (event.key === 'ArrowRight') {
                if (idx < debates.length - 1) {
                  idx = idx + 1;
                } else {
                  idx = 0;
                }
                render();
              }
            });
        
          } catch (err) {
            alert('Error: ' + (err.message));
          }
        })();
        </script>
        
        
</body>
</html>