<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Debate Web</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="w-[100vw] flex pt-[10vh] gap-[10vw]">
    <div class="flex flex-col h-screen">
        <!-- Model Select and Perspectives -->
        <div class="flex w-[30vw] justify-start gap-5 mb-3 ml-[10vw]">
            <!-- <button id="modelBtn" class="bg-white border border-gray-300 pt-[1vh] pb-[1vh] pl-[1vw] pr-[1vw] hover:bg-gray-200 rounded-xl">Model Select</button> -->
            
            <!-- <button class="bg-white border border-gray-300 pt-[1vh] pb-[1vh] pl-[1vw] pr-[1vw] hover:bg-gray-200 rounded-xl">Perspective</button> -->
            <label class="inline-flex items-center gap-2">
                <input type="checkbox" id="perspectiveToggle">
                <span>Perspectives</span>
            </label>
            <label class="inline-flex items-center gap-2">
                <input type="checkbox" id="modelToggle" class="h-4 w-4">
                <span>Model Select</span>
            </label>
        </div>

        <!-- Input Textarea -->
        <div id="inputRow" class="text-left ml-[10vw] relative">
            <label for="inputArea" class="absolute top-2 left-2 bg-white px-1 text-xs font-bold text-gray-600 z-10 pointer-events-none"><b>Input Text</b></label>
            <textarea name="inputArea" id="inputArea" class="autosize border pt-6 p-2.5 w-[30vw] h-[15vh]" placeholder="Input your text here!"></textarea>
        </div>
        <!-- Hidden Model Select -->
        <div id="modelRow" class="text-left ml-[10vw] mt-4 hidden">
            <div class="flex-col">
                <label class="block mb-1 font-medium text-sm">Model A [FOR]</label>
                <select id="modelA" class="border p-2 w-full"></select>
            </div>
            <div class="flex-col">
                <label class="block mt-3 mb-1 font-medium text-sm">Model B [AGAINST]</label>
                <select id="modelB" class="border p-2 w-full"></select>
            </div>
        </div>

        <!-- Hidden Perspectives Select -->
        <div id="perspectiveRow" class="ml-[10vw] mt-5 hidden flex items-start gap-6">
            <div class="flex-col">
                <label class="block mb-1 font-medium text-sm">Perspectives</label>
                <select id="perspectives" multiple class="border p-2 rounded w-[15vw] shrink-0">
                    <option value="legality">Legality</option>
                    <option value="ethics">Ethics</option>
                    <option value="morality">Morality</option>
                    <option value="economics">Economics</option>
                    <option value="public_health">Public health</option>
                    <option value="environment">Environmental impact</option>
                    <option value="security">Security/Risk</option>
                    <option value="human_rights">Human rights</option>
                    <option value="tech">Technical feasibility</option>
                    <option value="religion">Religion/Cultural values</option>
                </select>
            </div>

            <div id="perspectivePreview" class="text-sm text-gray-600 mt-1 flex-1 min-w-0 whitespace-normal break-words max-w-[10vw]">
                Selected perspectives are: -
            </div>
        </div>

          <!-- Start Debate -->
        <div class="flex justify-end w-[30vw] ml-[10vw] mt-2">
            <button class="bg-green-400 text-white border mt-2 border-green-300 pt-[1vh] pb-[1vh] pl-[1vw] pr-[1vw] hover:bg-gray-200 rounded-xl" id="runBtn">Initiate Debate</button>
        </div>
    </div>
    <div class="mt-[5vh] flex-1 h-full">
        <div class="mx-auto mr-[10vw]">
            <!-- <h1 class="font-bold">Summary</h1>
            <div id="summary" class="whitespace-pre-wrap">Summary put here</div>
            
            <h1 class="mt-2 font-bold">Opening</h1>
            <div id="opening" class="whitespace-pre-wrap">Opening put here</div>

            <h1 class="mt-2 font-bold">Rebuttal</h1>
            <div id="rebuttal" class="whitespace-pre-wrap">Rebuttal put here</div>

            <h1 class="mt-2 font-bold">Follow-up</h1>
            <div id="followup" class="whitespace-pre-wrap">Follow-up put here</div> -->

            <!-- BREAKING POINT -->
            <div class="relative col-start-2 w-full mt-3">
                <label for="summaryArea" class="absolute top-2 left-2 bg-white px-1 text-xs font-bold text-gray-600 z-10 pointer-events-none"><b>SUMMARY</b></label>
                <textarea id="summary" name="summaryArea" class="autosize border p-2.5 pt-6 w-full" style="height: 10vw;" placeholder="-" readonly></textarea>
                <!-- <button type="button"
                class="copy-btn absolute bottom-2 right-2 bg-blue-500 hover:bg-blue-600 text-white text-xs px-2 py-1 mb-1 rounded-md shadow"
                data-target="#summary">Copy</button> -->
            </div>
            <div class="col-start-2 flex gap-2 mt-3">
                <div class="relative flex-1">
                    <label for="openingFor" class="absolute top-2 left-2 bg-white px-1 text-xs font-bold text-gray-600 z-10 pointer-events-none"><b>OPENING [FOR]</b></label>
                    <textarea id="openingFor" name="openingFor" class="autosize border p-2.5 pt-6 w-full h-[8vw] resize-none" placeholder="-" readonly></textarea>
                    <!-- <button type="button"
                    class="copy-btn absolute bottom-2 right-2 bg-blue-500 hover:bg-blue-600 text-white text-xs px-2 py-1 mb-1 rounded-md shadow"
                    data-target="#openingFor">Copy</button> -->
                </div>
                <div class="relative flex-1">
                    <label for="openingAgainst" class="absolute top-2 left-2 bg-white px-1 text-xs font-bold text-gray-600 z-10 pointer-events-none"><b>OPENING [AGAINST]</b></label>
                    <textarea id="openingAgainst" name="openingAgainst" class="autosize border p-2.5 pt-6 w-full h-[8vw] resize-none" placeholder="-" readonly></textarea>
                    <!-- <button type="button"
                    class="copy-btn absolute bottom-2 right-2 bg-blue-500 hover:bg-blue-600 text-white text-xs px-2 py-1 mb-1 rounded-md shadow"
                    data-target="#openingAgainst">Copy</button> -->
                </div>
            </div>
            <div class="col-start-2 flex gap-2 mt-3">
                <div class="relative flex-1">
                    <label for="rebuttalFor" class="absolute top-2 left-2 bg-white px-1 text-xs font-bold text-gray-600 z-10 pointer-events-none"><b>REBUTTAL [FOR]</b></label>
                    <textarea id="rebuttalFor" name="rebuttalFor" class="autosize border p-2.5 pt-6 w-full h-[8vw] resize-none" placeholder="-" readonly></textarea>
                </div>
                <div class="relative flex-1">
                    <label for="rebuttalAgainst" class="absolute top-2 left-2 bg-white px-1 text-xs font-bold text-gray-600 z-10 pointer-events-none"><b>REBUTTAL [AGAINST]</b></label>
                    <textarea id="rebuttalAgainst" name="rebuttalAgainst" class="autosize border p-2.5 pt-6 w-full h-[8vw] resize-none" placeholder="-" readonly></textarea>
                </div>
            </div>
            <div class="col-start-2 flex gap-2 mt-3">
                <div class="relative flex-1">
                    <label for="followupFor" class="absolute top-2 left-2 bg-white px-1 text-xs font-bold text-gray-600 z-10 pointer-events-none"><b>FOLLOWUP [FOR]</b></label>
                    <textarea id="followupFor" name="followupFor" class="autosize border p-2.5 pt-6 w-full h-[8vw] resize-none" placeholder="-" readonly></textarea>
                </div>
                <div class="relative flex-1">
                    <label for="followupAgainst" class="absolute top-2 left-2 bg-white px-1 text-xs font-bold text-gray-600 z-10 pointer-events-none"><b>FOLLOWUP [AGAINST]</b></label>
                    <textarea id="followupAgainst" name="followupAgainst" class="autosize border p-2.5 pt-6 w-full h-[8vw] resize-none" placeholder="-" readonly></textarea>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = `http://localhost:3000`;

        const runBtn = document.getElementById('runBtn');
        const modelToggle = document.getElementById('modelToggle');
        const perspectiveToggle = document.getElementById('perspectiveToggle');
        const input = document.getElementById('inputArea');

        const inputRow = document.getElementById('inputRow');
        const modelRow = document.getElementById('modelRow');
        const perspectiveRow = document.getElementById('perspectiveRow');
        const selA = document.getElementById('modelA')
        const selB = document.getElementById('modelB')

        // Elements that are inside the HTML
        const elements = {
            summary: document.getElementById('summary'),
            openingFor: document.getElementById('openingFor'),
            openingAgainst: document.getElementById('openingAgainst'),
            rebuttalFor: document.getElementById('rebuttalFor'),
            rebuttalAgainst: document.getElementById('rebuttalAgainst'),
            followupFor: document.getElementById('followupFor'),
            followupAgainst: document.getElementById('followupAgainst'),
        };

        // Selection of models
        const MODELS = [
            "google/gemini-2.5-pro",
            "deepseek/deepseek-r1-0528",
            "qwen/qwen3-235b-a22b",
            "mistralai/mistral-medium-3.1",
            "openai/gpt-5-mini",
        ];

        // Fill the dropdown with models
        function populateModels(selectEl, models){
            selectEl.innerHTML = models.map(m => `<option value="${m}">${m}</option>`).join('');
        }

        // Here is for autosizing the textarea
        function autosize (element){
            element.style.height = 'auto';
            element.style.height = element.scrollHeight + 'px';
        }

        // Here is to use the function made before and apply it to the textareas that have the label 'autosize'
        function autosizeAll(root=document){
            root.querySelectorAll('textarea.autosize').forEach(ta =>{
                const handler = () => autosize(ta);
                handler();
                ta.addEventListener('input', handler);
                ta.addEventListener('change', handler);
            });
        }

        function updatePerspectiveView(){
            const perspectivePreview = document.getElementById('perspectivePreview');
            const sel = document.getElementById('perspectives');
            if (!perspectivePreview || !sel) return;
            const optionsArray = Array.from(sel.selectedOptions || []);
            if (optionsArray.length === 0){
                perspectivePreview.textContent = 'Selected perspectives are: -';
            }
            else{
                const labels = optionsArray.map(opt => opt.text.trim());
                perspectivePreview.textContent = 'Selected perspectives are: ' + labels.join(', ');
            }
        }

        // What happens when the page first loads
        document.addEventListener('DOMContentLoaded', () => {
            autosizeAll();
            populateModels(selA, MODELS);
            populateModels(selB, MODELS);

            selA.value = "google/gemini-2.5-pro";
            selB.value = "google/gemini-2.5-pro";
            const pers = document.getElementById('perspectives');
            if (pers){
                pers.addEventListener('change', updatePerspectiveView);
            }
            updatePerspectiveView();
        });

        modelToggle.addEventListener('change', (e) => {
            modelRow.classList.toggle('hidden', !e.target.checked);
        });

        perspectiveToggle.addEventListener('change', (e) => {
            perspectiveRow.classList.toggle('hidden', !e.target.checked);
            if (!perspectiveRow.classList.contains('hidden')) updatePerspectivePreview();
        });

        runBtn.addEventListener('click', async() => {
            const text = input.value.trim();
            if (!text) {
                alert("Enter some text first.");
                return;
            }

            const perspectiveSel = document.getElementById('perspectives');

            let perspectives = "Morality";
            
            if (perspectiveSel){
                const optionsArray = Array.from(perspectiveSel.selectedOptions);
                const labels = optionsArray.map(opt => opt.text.trim());
                perspectives = labels.join(', ');
            }
            
            
            runBtn.disabled = true;
            const previousLabel = runBtn.textContent;
            runBtn.textContent = "Running...";

            try {
                const response = await fetch('http://localhost:3000/api/run', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        text,
                        modelA: selA.value,
                        modelB: selB.value,
                        perspectives
                    })
                });
                const data = await response.json();
    
                elements.summary.value = data.summary || "";
                elements.openingFor.value     = data.aOpeningClipped     || "";
                elements.openingAgainst.value = data.bOpeningClipped     || "";
                elements.rebuttalFor.value    = data.aRebuttalClipped    || "";
                elements.rebuttalAgainst.value= data.bRebuttalClipped    || "";
                elements.followupFor.value    = data.aFollowupClipped    || "";
                elements.followupAgainst.value= data.bFollowupClipped    || "";
                Object.values(elements).forEach(ta => autosize(ta));


                // elements.opening.textContent = `FOR:\n${data.aOpeningClipped}\n\nAGAINST:\n${data.bOpeningClipped}`;
                // elements.rebuttal.textContent = `FOR:\n${data.aRebuttalClipped}\n\nAGAINST:\n${data.bRebuttalClipped}`;
                // elements.followup.textContent = `FOR:\n${data.aFollowupClipped}\n\nAGAINST:\n${data.bFollowupClipped}`;
            } catch (err){
                alert("Error: " + err.message);
            }
            finally {
                runBtn.disabled = false;
                runBtn.textContent = previousLabel;
            }
        });
    </script>

</body>

</html>